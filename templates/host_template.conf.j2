// {{ ansible_managed }}
{% import 'item_definitions.j2' as definitions %}
{% import 'object_attributes.j2' as attributes %}
{#
 # When the item is an agent include the Endpoint and Zone for the this agent
 # in the generates host configuration.
 #}
{% if item not in groups[i2_master_group]|union(groups[i2_satellite_group]) %}
{% set item_parent = hostvars[item].i2_parent_nodes[0] %}
{{ definitions.endpoint(item, item_parent, hostvars) }}

{{ definitions.zone(hostvars[item].i2_zonename, hostvars[item_parent].i2_zonename, hostvars) }}

{% endif %}
object Host "{{ hostvars[item].i2_hostname }}" {
  import "{{ hostvars[item].get('i2_host_template', 'generic-host') }}"
  address = "{{ hostvars[item].i2_address }}"

{% if item not in groups[i2_master_group] and item not in groups[i2_satellite_group] %}
  vars.agent_endpoint = name // Follows the convention that host name == endpoint name
{% endif %}
  vars.os = "{{ hostvars[item].ansible_system }}"
  vars.os_family = "{{ hostvars[item].ansible_os_family }}"
{% if hostvars[item].i2_child_satellite_zones is defined and
        hostvars[item].i2_child_satellite_zones|length > 0
%}
  // Satellite zones controlled by this master.
  {{ attributes.eval_value('zones', hostvars[item].i2_child_satellite_zones, 'vars.') }}
{%- endif %}

{%- if hostvars[item].i2_host_attributes is defined %}
{% set host_attributes = hostvars[item].i2_host_attributes %}
{{ attributes.attrs(host_attributes) }}
{%- endif %}
{% if hostvars[item].i2_host_variables is defined %}
{% set host_variables = hostvars[item].i2_host_variables %}
{{ attributes.attrs(host_variables, 'vars.') }}
{%- endif %}
}
